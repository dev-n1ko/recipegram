<section class="hero is-success">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">
        レシピ詳細
      </h1>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-7">
        <div class="card">
          <div class="card-image">
            <figure class="image is-4by3">
              <%= image_tag url_for(@recipe.image), class: "recipe_image" %>
            </figure>
          </div>
          <div class="card-content">
            <div class="media">
              <div class="media-content">
                <p class="title is-4"><%= @recipe.title %></p>
              </div>
            </div>
            <div class="content">
              <table class="table is-narrow">
                <tr>
                  <th>レシピ</th>
                </tr>
                <tr>
                  <td><%= simple_format @recipe.body %></td>
                </tr>
              </table>
              <% if user_signed_in? && @recipe.user.id == current_user.id %>
                <%= link_to "編集", edit_recipe_path(@recipe), class: "button is-success" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <div class="column is-4">
        <article class="panel is-link">
          <p class="panel-heading">
            By <%= @recipe.user.username %>
          </p>
          <div class="panel-block">
            <p class="control">
              <%= @recipe.user.profile %>
            </p>
          </div>
          <%= link_to user_path(@recipe.user), class: "panel-block" do %>
            <span class="panel-icon">
              <i class="fas fa-user" aria-hidden="true"></i>
            </span>
            <%= @recipe.user.username %>さんのぺージへ
          <% end %>
        </article>
        <h2 class="title is-5">コメント</h2>

        <% if user_signed_in? %>
          <%= form_with model: [@recipe, Comment.new], local: true do |f| %>
            <div class="field">
              <div class="control">
                <%= f.text_area :content,
                      class: "textarea",
                      placeholder: "コメントを書く" %>
              </div>
            </div>

            <div class="field">
              <%= f.submit "投稿", class: "button is-success" %>
            </div>
          <% end %>
        <% else %>
          <p>コメントするにはログインしてください</p>
        <% end %>

        <% if @comments.any? %>
          <% @comments.each do |comment| %>
            <div class="box comment-box">
              <article class="media">
                <figure class="media-left">
                  <%= link_to user_path(comment.user) do %>
                    <% if comment.user.image.attached? %>
                      <%= image_tag comment.user.image, class: "avatar" %>
                    <% else %>
                      <%= image_tag "no-image.png", class: "avatar" %>
                    <% end %>
                  <% end %>
                </figure>

                <div class="media-content comment-content">
                  <div class="content">
                    <p>
                      <strong>
                        <%= link_to comment.user.username, user_path(comment.user) %>
                      </strong>
                      <small class="has-text-grey">
                        <%= l(comment.created_at, format: :short) %>
                      </small>
                      <br>
                      <%= comment.content %>
                    </p>
                  </div>

                  <% if comment.user == current_user %>
                    <div class="comment-delete">  
                      <%= link_to "削除",
                        recipe_comment_path(@recipe, comment),
                        method: :delete,
                        data: { confirm: "削除しますか？" },
                        class: "button is-small is-text has-text-danger" %>
                    </div>
                  <% end %>
                </div>
              </article>
            </div>
          <% end %>
        <% else %>
          <p class="has-text-grey">まだコメントはありません</p>
        <% end %>
      </div>
    </div>
  </div>
</section>
        